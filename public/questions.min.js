(()=>{const random=(min,max)=>Math.floor(Math.random()*(max-min+1)+min);class QuestionHistory{constructor(lang,spicy){this.collection=spicy?lang+"-spicy":lang,localStorage.getItem(this.collection)||localStorage.setItem(this.collection,"")}insert=id=>{localStorage.setItem(this.collection,localStorage.getItem(this.collection)+","+id)};list=()=>localStorage[this.collection].split(",").slice(1);length=()=>this.list().length;clear=()=>{localStorage.removeItem(this.collection),localStorage.setItem(this.collection,"")};contains=id=>this.list().includes(id.toString())}const questionContainer=document.querySelector(".q-container.draggable"),currentQuestionText=document.querySelector("#current-q"),spicySwitch=document.querySelector("#spicy"),langSwitch=document.querySelector("#lang");function currentLang(){return langSwitch.checked?"et":"en"}function isSpicy(){return spicySwitch.checked}function langSpicy(lang=currentLang(),spicy=isSpicy()){return spicy?lang+"-spicy":lang}let qHistory={et:new QuestionHistory("et",!1),"et-spicy":new QuestionHistory("et",!0),en:new QuestionHistory("en",!1),"en-spicy":new QuestionHistory("en",!0)};async function getLastQuestionIndex(lang,spicy){const url=`${document.location.origin}/questions/${langSpicy(lang,spicy)}/count`;return parseInt(await(await fetch(url)).text())-1}async function getNewRandQuestion(){let randomIndex=random(0,lastIndex[langSpicy()]);if(qHistory[langSpicy()].length()>=lastIndex[langSpicy()]+1)randomIndex=qHistory[langSpicy()].list()[0],qHistory[langSpicy()].clear();else for(;qHistory[langSpicy()].contains(randomIndex);)randomIndex=random(0,lastIndex[langSpicy()]);const url=`${document.location.origin}/questions/${langSpicy()}/${randomIndex}`,question=(await fetch(url)).text();return qHistory[langSpicy()].insert(randomIndex),question}function until(conditionFunction){const poll=resolve=>{conditionFunction()?resolve():setTimeout(_=>poll(resolve),400)};return new Promise(poll)}let lastIndex={et:0,"et-spicy":0,en:0,"en-spicy":0},savedResult="",savedResult_langSpicy="";getLastQuestionIndex("et",!1).then(result=>{lastIndex.et=result,getLastQuestionIndex("et",!0).then(result=>{lastIndex["et-spicy"]=result,getLastQuestionIndex("en",!1).then(result=>{lastIndex.en=result,getLastQuestionIndex("en",!0).then(result=>{async function main(){await until(_=>!0===setupDone),getNewRandQuestion().then(result=>{if(savedResult=result,savedResult_langSpicy=langSpicy(),touchSupported){let newCardQuestionText=document.querySelector(".q-container:not(.draggable) > p"),currentCardQuestionText=document.querySelector(".q-container.draggable > p");langSpicy()===savedResult_langSpicy?newCardQuestionText.textContent=savedResult:getNewRandQuestion().then(result=>{newCardQuestionText.textContent=result});let firstTime=!0;document.addEventListener("newQuestionEvent",e=>{newCardQuestionText=document.querySelector(".q-container:not(.draggable) > p"),currentCardQuestionText=document.querySelector(".q-container.draggable > p"),e.detail?getNewRandQuestion().then(result=>{savedResult=result,savedResult_langSpicy=langSpicy(),newCardQuestionText.textContent=savedResult,getNewRandQuestion().then(result=>{savedResult=result,savedResult_langSpicy=langSpicy()})}):firstTime?getNewRandQuestion().then(result=>{savedResult=result,savedResult_langSpicy=langSpicy(),currentCardQuestionText.textContent=savedResult,getNewRandQuestion().then(result=>{savedResult=result,savedResult_langSpicy=langSpicy()})}):(langSpicy()===savedResult_langSpicy?currentCardQuestionText.textContent=savedResult:getNewRandQuestion().then(result=>{currentCardQuestionText.textContent=result}),getNewRandQuestion().then(result=>{savedResult=result,savedResult_langSpicy=langSpicy()})),firstTime=!1})}else questionContainer.addEventListener("click",()=>{langSpicy()===savedResult_langSpicy?currentQuestionText.textContent=savedResult:getNewRandQuestion().then(result=>{currentQuestionText.textContent=result}),getNewRandQuestion().then(result=>{savedResult=result,savedResult_langSpicy=langSpicy()})})})}lastIndex["en-spicy"]=result,main()})})})})})();